services:
  - type: web
    name: beaverhabits-web
    env: python
    region: oregon
    plan: free
    branch: main
    buildCommand: pip install . --no-cache-dir
    startCommand: gunicorn beaverhabits.main:app --bind 0.0.0.0:$PORT -w 1 -k uvicorn_worker.UvicornWorker --max-requests 5000 --log-level info
    envVars:
      - key: ENV
        value: production
      - key: NICEGUI_STORAGE_PATH
        value: .user/.nicegui
      - key: DATABASE_URL
        value: sqlite+aiosqlite:///:memory:
      # IMPORTANT: SQLite on Render's ephemeral disk will NOT persist between restarts.
      # For production with data persistence, use a managed PostgreSQL database:
      # - key: DATABASE_URL
      #   fromDatabase:
      #     name: beaverhabits-postgres
      #     property: connectionString
